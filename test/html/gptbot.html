<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js"></script>
    <!-- MQTT -->
    <script src="../js/mqttapp.js"></script>
    <!-- Flow Enhance -->
    <script src="../js/fixFlow.js"></script>
    <script src="../js/codeBlock.js"></script>
    <!-- Google Font Material Symbol -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons&display=swap">
    <script type="module" src="../coms/wa-select-prompt.js"></script>
    <script type="module" src="../coms/wa-voice.js"></script>
    <script type="module" src="../coms/wa-gpt-bot.js"></script>
    <script type="module" src="../coms/wa-carousel.js"></script>
    <link rel="stylesheet" href="./gptbot.css">
</head>

<body>
    <div id="gptbot-content">
        <div class="quiz-panel">
            <wa-carousel id="carousel"></wa-carousel>
        </div>
        <div class="chat-panel">
            <wa-select-prompt style="width:100%"></wa-select-prompt><br>
            <wa-gpt-bot id="gpt"></wa-gpt-bot>
            <br>
            <div class="menuBar">
                <wa-voice id='voice' class='menuBtn' callback="voiceToTextarea"></wa-voice>
                <wa-gpt-btn id="sendBtn" class='menuBtn' callback="send"></wa-gpt-btn>
            </div>
        </div>
    </div>
</body>

<script src="./oauth.js"></script>
<script>
    (async () => {
        if (!(await isLogin())) {
            parent.Main.popup(
                "還差一步！",
                "註冊帳號以獲取免費體驗",
                "info",
                "前往註冊",
            ).then(() => {
                logout();
            });
        }

        const user = await getUser();
        console.log(user);
        setCookies("userId", user?.id);

        if (!localStorage.getItem("isReadTerm")) {
            parent.Main.popup(
                "歡迎加入！",
                "您可以免費體驗直到 2023/07/31",
                "info",
                "知道了",
            ).then(() => {
                localStorage.setItem("isReadTerm", true)
            });
        }
    })();
</script>
<script src="./gptbot-lib.js"></script>
<script src="./gptbot.js"></script>

</html>